[{"statement":"Lemma otc_rfirmw_I : dom_rel (rfi ⨾ rmw ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite (rmw_in_ppo_loc WF).\napply tc_old.\n"},{"statement":"Lemma otc_rf_ppo_loc_I :\n  dom_rel (rf ⨾ ppo ∩ same_loc ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite rfi_union_rfe.\nrewrite !seq_union_l, dom_union.\nunionL.\n{\napply tc_old.\n}\narewrite (ppo ∩ same_loc ⊆ ppo).\netransitivity.\n2: by apply otc_dr_pb_I.\nbasic_solver 10.\n"},{"statement":"Lemma otc_rfrmw_I :\n  dom_rel (rf ⨾ rmw ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite rfi_union_rfe.\nrewrite !seq_union_l, dom_union.\nunionL.\n{\napply otc_rfirmw_I.\n}\nrewrite (rmw_in_ppo WF).\netransitivity.\n2: by apply otc_dr_pb_I.\nbasic_solver 10.\n"},{"statement":"Lemma otc_tc_fwbob_I : dom_rel (fwbob⁺ ⨾ ⦗I⦘) ⊆₁ C.","proof":"rewrite ct_end, !seqA.\nrewrite (dom_rel_helper (otc_fwbob_I tc_old)).\nrewrite fwbob_in_sb.\ngeneralize (@sb_trans G); ins; relsf.\ngeneralize (otc_sb_C tc_old).\nbasic_solver 12.\n"},{"statement":"Lemma otc_W_bob_I : dom_rel (⦗W⦘ ⨾ bob⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite tc_bob; relsf; splits; [| type_solver].\nrewrite (dom_rel_helper otc_tc_fwbob_I).\ngeneralize (otc_W_C_in_I tc_old).\nbasic_solver 12.\n"},{"statement":"Lemma otc_I_ar_I_implied_helper_0 :\n  dom_rel (⦗W⦘ ⨾  (bob ∪ ppo ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite (bob_ppo_W_sb WF).\nrewrite crE.\nrewrite wf_ppoD at 1 2.\nrelsf; splits; try type_solver.\narewrite (⦗I⦘ ⊆ ⦗W⦘ ⨾ ⦗I⦘).\n{\ngeneralize (otc_I_in_W tc_old).\nbasic_solver.\n}\nsin_rewrite bob_sb; relsf; splits.\n{\nrewrite !seqA.\narewrite ((⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)^? ⨾ ⦗W⦘ ⨾ ⦗I⦘ ⊆ ⦗I⦘ ⨾ sb^?).\n{\ngeneralize (otc_W_ex_sb_I tc_old).\nbasic_solver 12.\n}\ngeneralize otc_W_bob_I.\nbasic_solver 12.\n}\ngeneralize otc_W_ex_sb_I.\nbasic_solver 12.\n"},{"statement":"Lemma bob_W_ex_sb_W_ex_rfi_ct_alt :\n  (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘)⁺ ⨾ ⦗W⦘ ⊆\n  (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)＊ ⨾ (⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⨾ bob)^?.","proof":"rewrite unionC.\nrewrite path_union1.\nrewrite !seq_union_l.\nunionL.\n{\nrewrite rtE.\nbasic_solver 10.\n}\nhahn_frame_l.\narewrite (⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ∪            ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⨾ (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)⁺ ⊆            ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⨾ (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)＊).\n{\nrewrite rtE.\nbasic_solver 20.\n}\narewrite (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ⊆ sb).\n{\nrewrite bob_in_sb.\nbasic_solver.\n}\nrewrite rt_of_trans; [|by apply sb_trans].\nrewrite ct_begin.\narewrite (⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⨾ sb^? ⊆ sb) at 2.\n{\nunfold Execution.rfi.\ngeneralize (@sb_trans G).\nbasic_solver.\n}\nrewrite rt_of_trans; [|by apply sb_trans].\narewrite (sb^? ⨾ sb^? ⊆ sb^?).\n{\ngeneralize (@sb_trans G).\nbasic_solver.\n}\nrewrite crE.\nrewrite !seq_union_l, !seq_union_r, seq_id_l.\nunionL.\n{\ntype_solver.\n}\narewrite (⦗R ∩₁ Acq⦘ ⊆ ⦗R ∩₁ Acq⦘ ⨾ ⦗R ∩₁ Acq⦘) at 1.\n{\nbasic_solver.\n}\narewrite (⦗R ∩₁ Acq⦘ ⨾ sb ⊆ bob).\nbasic_solver 10.\n"},{"statement":"Lemma dom_W_ex_rfi_Acq_bob_I_in_I :\n  dom_rel (⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⨾ bob ⨾ ⦗I⦘) ⊆₁ I.","proof":"etransitivity.\n2: by apply otc_dr_pb_I; auto.\nbasic_solver 20.\n"},{"statement":"Lemma dom_W_ex_rfi_Acq_bob_cr_I_in_I :\n  dom_rel ((⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⨾ bob)^? ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite crE.\nrewrite seq_union_l, dom_union.\nunionL.\n{\nbasic_solver.\n}\nrewrite !seqA.\nby apply dom_W_ex_rfi_Acq_bob_I_in_I.\n"},{"statement":"Lemma otc_I_ar_I_implied_helper_1 :\n  dom_rel (⦗W⦘ ⨾ (bob ∪ ppo ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘)⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite (bob_ppo_W_ex_rfi_W_sb WF).\nrewrite crE.\nrewrite wf_ppoD at 1 2.\nrelsf; splits; try type_solver.\narewrite (⦗I⦘ ⊆ ⦗W⦘ ⨾ ⦗I⦘).\n{\ngeneralize (otc_I_in_W tc_old); basic_solver.\n}\nsin_rewrite bob_W_ex_sb_W_ex_rfi_ct_alt.\nrewrite !seqA.\nrewrite (dom_rel_helper dom_W_ex_rfi_Acq_bob_cr_I_in_I).\nrewrite <- !seqA.\ndo 2 rewrite dom_seq.\nrewrite !seqA.\nrewrite rtE.\nrelsf.\nsplit; [basic_solver|].\nrewrite <- dom_eqv1.\narewrite (bob ⊆ bob ∪ ppo).\nby apply otc_I_ar_I_implied_helper_0.\n"},{"statement":"Lemma otc_dr_ppo_I : dom_rel ((rfe ∪ detour) ⨾ ppo ⨾ ⦗I⦘) ⊆₁ I.","proof":"etransitivity.\n2: by apply (otc_dr_pb_I tc_old).\nbasic_solver 10.\n"},{"statement":"Lemma otc_dr_bob_I : dom_rel ((rfe ∪ detour) ⨾ bob ⨾ ⦗I⦘) ⊆₁ I.","proof":"etransitivity.\n2: by apply otc_dr_pb_I; auto.\nbasic_solver 20.\n"},{"statement":"Lemma otc_dr_bob_ct_I : dom_rel ((rfe ∪ detour) ⨾ bob⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"remember (rfe ∪ detour) as rd.\nrewrite tc_bob.\nrewrite !seq_union_l, !seq_union_r, !dom_union.\nunionL.\n2: {\narewrite (⦗R ∩₁ Acq⦘ ⨾ sb ⊆ bob).\nsubst rd.\nby apply otc_dr_bob_I.\n}\nrewrite (dom_rel_helper otc_tc_fwbob_I).\nsubst rd; relsf.\nsplit.\n{\ngeneralize (otc_rf_C tc_old); unfold Execution.rfe.\nbasic_solver 21.\n}\nrewrite (dom_l (wf_detourD WF)).\nrewrite detour_in_sb.\ngeneralize (otc_sb_C tc_old) (otc_W_C_in_I tc_old); basic_solver 21.\n"},{"statement":"Lemma otc_I_ar_I_implied_helper_2 :\n   dom_rel (⦗W⦘ ⨾ ar⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"assert (wf_sc G sc) as WFS by apply IMMCON.\nassert (bob ∪ ppo ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⊆ sb) as AA.\n{\nrewrite (ppo_in_sb WF), bob_in_sb.\narewrite (rfi ⊆ sb).\nbasic_solver 10.\n}\nassert (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘ ⊆ sb) as BB.\n{\nrewrite bob_in_sb.\narewrite (rfi ⊆ sb).\nbasic_solver 10.\n}\nunfold imm_s.ar, ar_int.\narewrite (sc ∪ rfe ∪               (bob ∪ ppo ∪ detour ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘) ⊆             (bob ∪ ppo ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘) ∪            (sc ∪ rfe ∪ detour)).\n{\nbasic_solver 12.\n}\nremember (sc ∪ rfe ∪ detour) as srd.\nremember (bob ∪ ppo ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘ ∪ ⦗W_ex⦘ ⨾ rfi ⨾ ⦗R ∩₁ Acq⦘) as bps.\nrewrite unionC.\nrewrite path_union1.\narewrite (srd ∪ srd ⨾ bps⁺ ⊆ srd ⨾ bps＊).\n{\nrewrite rtE.\nbasic_solver 12.\n}\nrelsf; splits.\n{\ngeneralize otc_I_ar_I_implied_helper_1.\nrewrite <- Heqbps.\nbasic_solver 21.\n}\nrewrite !seqA, <- dom_eqv1.\narewrite (⦗W⦘ ⨾ bps＊ ⨾ (srd ⨾ bps＊)⁺ ⨾ ⦗I⦘ ⊆ ⦗I⦘ ⨾ (fun _ _ => True)); cycle 1.\n{\ngeneralize (otc_W_C_in_I tc_old).\nbasic_solver.\n}\nrewrite inclusion_t_rt.\narewrite (I ⊆₁ I ∪₁ C ∩₁ F ∩₁ Sc) at 1.\napply rt_ind_right with (P:= fun r =>  ⦗W⦘ ⨾ bps＊ ⨾ r ⨾ ⦗I ∪₁ C ∩₁ F ∩₁ Sc⦘).\n{\nauto with hahn.\n}\n{\nrels.\nrewrite rtE; relsf.\nsubst.\nunionL.\n{\ntype_solver.\n}\nrewrite id_union; relsf; unionL.\n{\nrewrite (dom_rel_helper otc_I_ar_I_implied_helper_1).\nsubst.\nbasic_solver 12.\n}\nrewrite AA.\nrewrite ct_of_trans; [|by apply sb_trans].\narewrite (⦗C ∩₁ F ∩₁ Sc⦘ ⊆  ⦗C⦘) by basic_solver.\nrewrite (dom_rel_helper (otc_sb_C tc_old)).\ngeneralize (otc_W_C_in_I tc_old); basic_solver.\n}\nintros k H; rewrite !seqA.\nrewrite rtE at 2; relsf; unionL; subst srd.\n{\nrewrite (wf_scD WFS).\nrewrite (otc_I_in_W tc_old) at 1.\nrewrite (dom_r (wf_rfeD WF)).\nrewrite (dom_r (wf_detourD WF)).\nrewrite id_union; relsf; unionL; try type_solver.\nrewrite !seqA.\narewrite (⦗F ∩₁ Sc⦘ ⨾ sc ⨾ ⦗F ∩₁ Sc⦘ ⨾ ⦗C ∩₁ F ∩₁ Sc⦘ ⊆ ⦗I ∪₁ C ∩₁ F ∩₁ Sc⦘ ⨾ (fun _ _ : actid => True)).\n{\ngeneralize (otc_sc_C tc_old); basic_solver 21.\n}\nsin_rewrite H; basic_solver.\n}\nrewrite !unionA.\nremember (rfe ∪ detour) as rd.\nrelsf; unionL.\n{\ncut (sc ⨾ bps⁺ ⨾ ⦗I ∪₁ C ∩₁ F ∩₁ Sc⦘ ⊆ ⦗C ∩₁ F ∩₁ Sc⦘ ⨾ (fun _ _ : actid => True)).\n{\nintro A.\nsin_rewrite A.\narewrite (C ∩₁ F ∩₁ Sc ⊆₁ I ∪₁ C ∩₁ F ∩₁ Sc) at 1.\nsin_rewrite H.\nbasic_solver.\n}\nsubst bps.\nrewrite AA.\nrewrite ct_of_trans; [|by apply sb_trans].\nrewrite (wf_scD WFS), !seqA.\nrewrite id_union; relsf; unionL.\n{\narewrite (⦗F ∩₁ Sc⦘ ⨾ sb ⊆ fwbob).\n{\nunfold imm_bob.fwbob.\nmode_solver.\n}\ngeneralize (otc_sc_C tc_old) (otc_fwbob_I tc_old).\nbasic_solver 21.\n}\ngeneralize (otc_sc_C tc_old) (otc_sb_C tc_old).\nbasic_solver 21.\n}\ncut (rd ⨾ bps⁺ ⨾ ⦗I ∪₁ C ∩₁ F ∩₁ Sc⦘ ⊆ ⦗I⦘ ⨾ (fun _ _ : actid => True)).\n{\nintro A.\nsin_rewrite A.\narewrite (I ⊆₁ I ∪₁ C ∩₁ F ∩₁ Sc) at 1.\nsin_rewrite H.\nbasic_solver.\n}\nsubst bps.\nrewrite (bob_ppo_W_ex_rfi_W_sb WF); relsf; unionL.\n{\nrewrite id_union; relsf; unionL.\n{\ngeneralize (otc_dr_pb_I tc_old).\nsubst rd.\nbasic_solver 12.\n}\nrewrite wf_ppoD.\ntype_solver.\n}\nrewrite id_union; relsf; unionL.\n{\narewrite (⦗I⦘ ⊆ ⦗W⦘ ⨾ ⦗I⦘).\n{\ngeneralize (otc_I_in_W tc_old).\nbasic_solver.\n}\nsin_rewrite bob_W_ex_sb_W_ex_rfi_ct_alt.\nrewrite !seqA.\nrewrite (dom_rel_helper (dom_W_ex_rfi_Acq_bob_cr_I_in_I)).\narewrite (rd ⨾ ppo^? ⨾ (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)＊ ⨾ ⦗I⦘ ⊆              ⦗I⦘ ⨾ rd ⨾ ppo^? ⨾ (bob ∪ ⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)＊ ⨾ ⦗I⦘).\n2: basic_solver.\napply dom_rel_helper.\nrewrite rtE.\nrewrite !seq_union_l, !seq_union_r, dom_union, seq_id_l.\nunionL.\n{\nrewrite crE.\nrewrite !seq_union_l, !seq_union_r, dom_union, seq_id_l.\nunionL; subst rd.\n2: by apply otc_dr_ppo_I.\nrewrite (otc_I_in_W tc_old) at 1.\nrewrite (dom_r (wf_rfeD WF)), (dom_r (wf_detourD WF)).\nmode_solver.\n}\nrewrite crE.\nrewrite !seq_union_l, !seq_union_r, dom_union, seq_id_l.\nunionL.\n2: {\nrewrite (dom_r (wf_ppoD G)), !seqA.\narewrite (bob ⊆ bob ∪ ppo).\nrewrite (dom_rel_helper otc_I_ar_I_implied_helper_0).\nsubst rd.\narewrite ((rfe ∪ detour) ⨾ ppo ⨾ ⦗I⦘ ⊆ ⦗I⦘ ⨾ (rfe ∪ detour) ⨾ ppo ⨾ ⦗I⦘).\n{\napply dom_rel_helper.\napply otc_dr_ppo_I.\n}\nbasic_solver.\n}\narewrite (⦗I⦘ ⊆ ⦗W⦘ ⨾ ⦗I⦘).\n{\ngeneralize (otc_I_in_W tc_old).\nbasic_solver.\n}\nsin_rewrite bob_sb.\nrewrite !seq_union_l, !seq_union_r, dom_union.\nunionL.\n2: {\nsubst rd.\nrewrite (W_ex_acq_in_W WF).\nrewrite (dom_r (wf_rfeD WF)), (dom_r (wf_detourD WF)).\nmode_solver.\n}\nrewrite !seqA.\narewrite ((⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)^? ⨾ ⦗W⦘ ⨾ ⦗I⦘ ⊆              ⦗I⦘ ⨾ (⦗W_ex_acq⦘ ⨾ sb ⨾ ⦗W⦘)^? ⨾ ⦗W⦘ ⨾ ⦗I⦘).\n{\napply dom_rel_helper.\nrewrite crE.\nrewrite !seq_union_l, seq_id_l, dom_union.\nunionL.\n{\nbasic_solver.\n}\netransitivity.\n2: by apply (otc_W_ex_sb_I tc_old).\nbasic_solver 10.\n}\nrewrite <- !seqA.\ndo 3 rewrite dom_seq.\nrewrite seqA.\nsubst rd.\nby apply otc_dr_bob_ct_I.\n}\nrewrite BB.\nrewrite ct_of_trans; [|by apply sb_trans].\narewrite (⦗C ∩₁ F ∩₁ Sc⦘ ⊆  ⦗C⦘).\n{\nbasic_solver.\n}\nrewrite (ppo_in_sb WF).\narewrite (sb^? ⨾ sb ⊆ sb).\n{\ngeneralize (@sb_trans G).\nbasic_solver.\n}\nrewrite (dom_rel_helper (otc_sb_C tc_old)).\nsubst rd; relsf; unionL.\n{\ngeneralize (otc_rf_C tc_old); unfold Execution.rfe.\nbasic_solver 21.\n}\nrewrite (dom_l (wf_detourD WF)).\nrewrite detour_in_sb.\ngeneralize (otc_sb_C tc_old) (otc_W_C_in_I tc_old); basic_solver 21.\n"},{"statement":"Lemma otc_rf_ppo_loc_ct_I :\n  dom_rel ((rf ⨾ ppo ∩ same_loc)⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"intros x [y HH].\ndestruct_seq_r HH as IY.\ninduction HH as [x y AA|x y z AA BB].\n2: by intuition.\napply otc_rf_ppo_loc_I; auto.\neexists.\napply seqA.\napply seq_eqv_r.\nsplit; eauto.\n"},{"statement":"Lemma otc_rfrmw_ct_I :\n  dom_rel ((rf ⨾ rmw)⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite (rmw_in_ppo_loc WF).\napply otc_rf_ppo_loc_ct_I.\n"},{"statement":"Lemma otc_I_ar_rf_ppo_loc_I_implied_helper_2 :\n   dom_rel (⦗W⦘ ⨾ (ar ∪ rf ⨾ ppo ∩ same_loc)⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"assert (wf_sc G sc) as WFS by apply IMMCON.\nrewrite ct_step with (r:=ar) at 1.\nrewrite unionC.\nrewrite path_absorb1.\n2: {\napply ar_ct_rf_ppo_loc_in_ar_ct; auto.\n}\nrewrite !seq_union_l, !seq_union_r, !dom_union.\nunionL.\n{\narewrite_id ⦗W⦘.\nrewrite seq_id_l.\nby apply otc_rf_ppo_loc_ct_I.\n}\n{\nrewrite ct_of_ct.\napply otc_I_ar_I_implied_helper_2; auto.\n}\nrewrite ct_of_ct; rewrite seqA.\narewrite ((rf ⨾ ppo ∩ same_loc)⁺ ⊆ (rf ⨾ ppo ∩ same_loc)⁺ ⨾ ⦗W⦘).\n{\nrewrite (dom_r (wf_ppoD G)) at 1.\nrewrite seq_eqv_inter_lr.\nrewrite <- !seqA.\nby rewrite inclusion_ct_seq_eqv_r.\n}\nrewrite (dom_rel_helper otc_I_ar_I_implied_helper_2).\narewrite_id ⦗W⦘.\nrewrite !seq_id_l.\nrewrite <- !seqA.\nrewrite (dom_rel_helper otc_rf_ppo_loc_ct_I).\nbasic_solver.\n"},{"statement":"Lemma otc_I_ar_rfrmw_I_implied_helper_2 :\n   dom_rel (⦗W⦘ ⨾ (ar ∪ rf ⨾ rmw)⁺ ⨾ ⦗I⦘) ⊆₁ I.","proof":"rewrite (rmw_in_ppo_loc WF).\napply otc_I_ar_rf_ppo_loc_I_implied_helper_2.\n"}]